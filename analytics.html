<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics Dashboard - Tax Relief Experts</title>
    <link rel="stylesheet" href="libs/fonts/poppins/poppins.css">
    <link rel="stylesheet" href="libs/fontawesome/css/all.min.css">
    <link rel="stylesheet" href="dashboard.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <div class="dashboard-wrapper">
        <!-- Top Navigation Bar -->
        <nav class="dashboard-nav">
            <div class="nav-content">
                <div class="nav-brand">
                    <i class="fas fa-chart-pie"></i>
                    <span>Analytics</span>
                </div>
                <div class="nav-actions">
                    <select id="timeRange" class="nav-select">
                        <option value="7">7 Days</option>
                        <option value="30" selected>30 Days</option>
                        <option value="90">90 Days</option>
                        <option value="365">1 Year</option>
                    </select>
                    <button id="refreshBtn" class="nav-btn">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                </div>
            </div>
        </nav>

        <!-- Main Dashboard Content -->
        <main class="dashboard-main">
            <!-- Key Metrics Row -->
            <section class="metrics-row">
                <div class="metric-card metric-card--primary">
                    <div class="metric-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="metric-content">
                        <div class="metric-value" id="totalSessions">0</div>
                        <div class="metric-label">Total Sessions</div>
                    </div>
                </div>
                
                <div class="metric-card metric-card--success">
                    <div class="metric-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="metric-content">
                        <div class="metric-value" id="avgCompletion">0%</div>
                        <div class="metric-label">Completion Rate</div>
                        <div class="metric-subtext" id="completionBreakdown"></div>
                    </div>
                </div>
                
                <div class="metric-card metric-card--warning">
                    <div class="metric-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="metric-content">
                        <div class="metric-value" id="totalDropoffs">0</div>
                        <div class="metric-label">Drop-offs</div>
                        <div class="metric-subtext" id="dropoffRate">0% drop-off rate</div>
                    </div>
                </div>
                
                <div class="metric-card metric-card--info">
                    <div class="metric-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="metric-content">
                        <div class="metric-value" id="avgTime">0s</div>
                        <div class="metric-label">Avg Time</div>
                        <div class="metric-subtext">Per session</div>
                    </div>
                </div>
            </section>

            <!-- Insights & Actions -->
            <section class="insights-section">
                <div class="insight-card insight-card--critical">
                    <div class="insight-header">
                        <i class="fas fa-fire"></i>
                        <h3>Critical Issues</h3>
                    </div>
                    <div class="insight-content" id="criticalInsights">
                        <div class="insight-item">
                            <i class="fas fa-spinner fa-spin"></i>
                            <span>Analyzing data...</span>
                        </div>
                    </div>
                </div>
                
                <div class="insight-card insight-card--opportunity">
                    <div class="insight-header">
                        <i class="fas fa-lightbulb"></i>
                        <h3>Quick Wins</h3>
                    </div>
                    <div class="insight-content" id="opportunityInsights">
                        <div class="insight-item">
                            <i class="fas fa-spinner fa-spin"></i>
                            <span>Analyzing data...</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Performance Overview -->
            <section class="performance-section">
                <div class="section-header">
                    <h2>Performance Overview</h2>
                    <p class="section-subtitle">Completion rates and engagement metrics</p>
                </div>
                <div class="chart-grid">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3>Completion Rate</h3>
                            <div class="chart-legend">
                                <span class="legend-item"><span class="legend-color" style="background: #4ade80;"></span> High (â‰¥90%)</span>
                                <span class="legend-item"><span class="legend-color" style="background: #eac344;"></span> Medium (50-89%)</span>
                                <span class="legend-item"><span class="legend-color" style="background: #ef4444;"></span> Low (<50%)</span>
                            </div>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="completionChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-card chart-card--compact">
                        <div class="chart-header">
                            <h3>Distribution</h3>
                        </div>
                        <div class="chart-wrapper chart-wrapper--small">
                            <canvas id="completionPieChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Drop-off Analysis -->
            <section class="dropoff-section">
                <div class="section-header">
                    <h2>Drop-off Analysis</h2>
                    <p class="section-subtitle">Identify where users abandon the flow</p>
                </div>
                <div class="dropoff-content">
                    <div class="dropoff-chart-card">
                        <canvas id="dropoffChart"></canvas>
                    </div>
                    <div class="dropoff-list" id="topDropoffs">
                        <!-- Dynamically populated -->
                    </div>
                </div>
            </section>

            <!-- Question Performance - Waterfall -->
            <section class="questions-section">
                <div class="section-header">
                    <h2>Question Flow Analysis</h2>
                    <p class="section-subtitle">Visualize user progression through questions</p>
                </div>
                <div class="waterfall-container" id="questionPerformance">
                    <!-- Dynamically populated waterfall charts -->
                </div>
            </section>
        </main>
    </div>
    
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p>Loading analytics...</p>
        </div>
    </div>
    
    <script>
        window.DASHBOARD_API_URL = 'https://tre-chatbot-analytics-api-x2aka.ondigitalocean.app';
    </script>
    <script src="dashboard.js"></script>
</body>
</html>
